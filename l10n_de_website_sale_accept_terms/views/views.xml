<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

        <!-- Add needed CSS and JS in template -->
        <template id="assets_frontend" inherit_id="website.assets_frontend" name="Accept Terms on Checkout">
          <xpath expr="." position="inside">
                <link rel='stylesheet' href='/l10n_de_website_sale_accept_terms/static/src/css/style.css'/>
          </xpath>
        </template>

        <!-- Replace the payment-site -->
        <template id="wsga_payment" name="Checkout with Accept Terms" inherit_id="website_sale.payment">
            
            <xpath expr="//div[@id='wrap']" position="replace"> 
              <div id="wrap">
                <div class="container oe_website_sale">

                  <ul class="wizard pull-right">
                      <li><a href="/shop/cart" class="text-success">Review Order<span class="chevron"></span></a></li>
                      <li><a href="/shop/checkout" class="text-success">Shipping &amp; Billing<span class="chevron"></span></a></li>
                      <li class="text-primary">Payment<span class="chevron"></span></li>
                      <li class="text-muted">Confirmation<span class="chevron"></span></li>
                  </ul>
                  <h1 class="mb32">Validate Order</h1>
                  
                  <t t-set="website_sale_order" t-value="website.sale_get_order()"/>
                  
                  <div class="row">
                  
                    <div class="col-lg-8 col-sm-9 oe_cart">
                    
                    <div t-if="deliveries" id="delivery_carrier">
                        <div class="wsga-mb30" >
                        <h4>Choose your Delivery Method</h4>
                            <ul class="list-unstyled">
                                <li t-foreach="deliveries" t-as="delivery">
                                    <label>
                                        <input t-att-value="delivery.id" type="radio" name="delivery_type"
                                            t-att-checked="order.carrier_id and order.carrier_id.id == delivery.id and 'checked' or False" 
                                            t-att-disabled="delivery.available and '0' or '1'"/>
                                        <span t-field="delivery.name"/>
                                        <t t-if="delivery.available">
                                            <span class="badge" t-field="delivery.price"
                                                t-field-options='{
                                                    "widget": "monetary",
                                                    "display_currency": "website.pricelist_id.currency_id"
                                                }'/>
                                        </t>
                                    </label>
                                </li>
                            </ul>
                        </div>
                    </div>
         
                    <div class="js_payment" t-if="acquirers and website_sale_order.amount_total" id="payment_method">
                      <div class="wsga-mb30" >
                          <h4>Choose your Payment Method</h4>
                          <ul class="list-unstyled">
                            <li t-foreach="acquirers or []" t-as="acquirer">
                              <label t-if="acquirer.button">
                                  <input t-att-value="acquirer.id" type="radio" name="acquirer" t-att-checked="acquirers[0] == acquirer"/>
                                  <img class="media-object" style="width: 60px; display: inline-block;"
                                      t-att-title="acquirer.name"
                                      t-att-src="'/payment_%s/static/src/img/%s_icon.png' % (acquirer.provider, acquirer.provider)"/>
                                      <span t-field="acquirer.name"/>
                              </label>
                            </li>
                          </ul>
                      </div>
                      
                      <div class="wsga-mb30">
                          <h4 id="rev">Terms and revocation!</h4>
                          <div id="revlabel" class="form-group">
                              <p>With click on the button "Pay now" I accept the <span id="open-terms" class="wsga-cursor">terms</span> and the <span id="open-revo" class="wsga-cursor">revocation</span>.</p>
                          </div>
                      </div>
                      
                      <div class="wsga-highlight wsga-mb10">
                          <t t-set="website_sale_order" t-value="website.sale_get_order()"/>
                          <table class="table table-striped table-condensed" id="cart_products" t-if="website_sale_order and website_sale_order.website_order_line">
                              <thead>
                                  <tr>
                                      <th colspan="2" width="80">Product</th>
                                      <th class="text-right" width="100">Price</th>
                                      <th class="text-right" width="80">Quantity</th>
                                      <th class="text-right" width="120">Subtotal</th>
                                  </tr>
                              </thead>
                              <tbody>
                                  <tr t-foreach="website_sale_order.website_order_line" t-as="line">
                                      <td colspan="2" t-if="not line.product_id.product_tmpl_id"></td>
                                      <td t-if="line.product_id.product_tmpl_id">
                                          <a t-attf-href="/shop/product/#{ slug(line.product_id.product_tmpl_id) }">
                                              <span t-field="line.product_id.image_small"
                                                    t-field-options='{"widget": "image", "class": "img-rounded"}'/>
                                          </a>
                                      </td>
                                      <td t-if="line.product_id.product_tmpl_id">
                                         <strong t-field="line.product_id.name"/><br/>
                                         <span t-field="line.product_id.description_sale"/>
                                      </td>
                                      <td class="text-right">
                                         <span t-field="line.price_unit" style="white-space: nowrap;" t-field-options='{
                                             "widget": "monetary",
                                             "display_currency": "user_id.partner_id.property_product_pricelist.currency_id"
                                         }'/>
                                      </td>
                                      <td class="text-right">
                                         <div t-esc="line.product_uom_qty"/>
                                      </td>
                                      <td class="text-right">
                                         <span t-field="line.price_subtotal" style="white-space: nowrap;" t-field-options='{
                                             "widget": "monetary",
                                             "display_currency": "user_id.partner_id.property_product_pricelist.currency_id"
                                         }'/>
                                      </td>
                                  </tr>
                              </tbody>
                          </table>
                          <t t-call="website_sale.total"/>
                          <div class="clearfix"/>
                        </div>
                      
                      <div>
                          <t t-foreach="acquirers or []" t-as="acquirer">
                              <div t-att-data-id="acquirer.id" class="oe_sale_acquirer_button hidden pull-right wsga-mb60 wsga-text-right">
                                <div t-raw="acquirer.button"/>
                                <div class="wsga-hide" t-field="acquirer.pre_msg"/>
                              </div>
                          </t>
                      </div>
                    </div>
         
                    </div>
                    
                    <div class="col-lg-3 col-lg-offset-1 col-sm-3 text-muted" id="right_column">
                        <h4>Bill To:</h4>
                        <div t-field="order.partner_invoice_id" t-field-options='{
                            "widget": "contact",
                            "fields": ["address", "name", "phone", "email"]
                            }'/>
                        <div>
                          <a href="/shop/checkout"><span class="fa fa-arrow-right"/> Change Address</a>
                        </div>
                        <t>
                            <h4 class="mt32">Ship To:</h4>
                            <t t-if="website_sale_order.partner_shipping_id and website_sale_order.partner_shipping_id.id != website_sale_order.partner_invoice_id.id">
                              <div t-field="order.partner_shipping_id" t-field-options='{
                                "widget": "contact",
                                "fields": ["address", "name", "phone"]
                                }'/>
                            </t>
                            <address t-if="website_sale_order.partner_shipping_id.id == website_sale_order.partner_invoice_id.id">Ship to the same address</address>
                            <div class="mb32">
                              <a href="/shop/checkout"><span class="fa fa-arrow-right"/> Change Address</a>
                            </div>
                        </t>
                    </div> 
                    
                  </div> 
                  
                </div>
              </div>

              <div id="wsga-terms" class="wsga-popover wsga-center" style="display:none;">
                    <h3 class="popover-title">
                        Terms
                        <button id="close-terms" title="close" type="button" class="close">×</button>
                    </h3>
                    <iframe src="../../popover/terms/"/>
                </div>
                

              <div id="wsga-revo" class="wsga-popover wsga-center" style="display:none;">
                    <h3 class="popover-title">
                        Revocation
                        <button id="close-revo" title="close" type="button" class="close">×</button>
                    </h3>
                    <iframe src="../../popover/revocation/"/>       
              </div>
            
            </xpath>     
        </template>

        <!-- Add needed websites for necsessary informations -->
        <!-- Template for terms-page -->  
        <template id="terms" name="Terms" page="True">
            <t t-call="website.layout">
                <div id="wrap">
                    <div class="oe_structure">
                        <div class="container">
                            <div class="row">
                                <div class="col-md-12">
                                    <h1 class="text-center">Terms</h1>
                                    <h3 class="text-muted text-center">Add your terms here!</h3>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </t>
        </template>

        <!-- Template for revocation-page -->  
        <template id="revocation" name="Revocation" page="True">
            <t t-call="website.layout">
                <div id="wrap">
                    <div class="oe_structure">
                        <div class="container">
                            <div class="row">
                                <div class="col-md-12">
                                    <h1 class="text-center">Revocation</h1>
                                    <h3 class="text-muted text-center">Add your revocation conditions here!</h3>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </t>
        </template>

        <!-- Template for delivery-page (terms of sale) -->   
        <template id="delivery" name="Delivery" page="True">
            <t t-call="website.layout">
                <div id="wrap">
                    <div class="oe_structure">
                        <div class="container">
                            <div class="row">
                                <div class="col-md-12">
                                    <h1 class="text-center">Delivery</h1>
                                    <h3 class="text-muted text-center">Add your terms of sale here!</h3>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </t>
        </template>

        <!-- Template for privacy-page -->   
        <template id="privacy" name="Privacy" page="True">
            <t t-call="website.layout">
                <div id="wrap">
                    <div class="oe_structure">
                        <div class="container">
                            <div class="row">
                                <div class="col-md-12">
                                    <h1 class="text-center">Privacy</h1>
                                    <h3 class="text-muted text-center">Add your privacy here!</h3>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </t>
        </template>

        <!-- Template for imprint-page -->  
        <template id="imprint" name="Imprint" page="True">
            <t t-call="website.layout">
                <div id="wrap">
                    <div class="oe_structure">
                        <div class="container">
                            <div class="row">
                                <div class="col-md-12">
                                    <h1 class="text-center">Imprint</h1>
                                    <h3 class="text-muted text-center">Add your imprint here!</h3>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </t>
        </template>

        <!-- Add links to standard footer --> 
        <template id="footer_wsga" inherit_id="website.footer_default" name="Footer WSGA">
            <xpath expr="//ul[@id='products']" position="inside"> 
                <li><a href="/page/imprint">Imprint</a></li>
                <li><a href="/page/terms">Terms</a></li>
                <li><a href="/page/revocation">Revocation</a></li>
                <li><a href="/page/delivery">Delivery</a></li>
                <li><a href="/page/privacy">Privacy</a></li>
            </xpath>
        </template>

        <!-- Terms popover bind as iframe --> 
        <template id="popover_terms" name="German terms popover">
            <link id="bootstrap_css" rel='stylesheet' href='/web/static/lib/bootstrap/css/bootstrap.css' t-ignore="true"/>
            <link rel="stylesheet" href='/website/static/src/css/website.css' t-ignore="true"/>
            <t t-set="view" t-value="html_view"/>
            <div t-raw="view"/>
        </template>

        <!-- Revocation popover bind as iframe --> 
        <template id="popover_revocation" name="German revocation popover">
            <link id="bootstrap_css" rel='stylesheet' href='/web/static/lib/bootstrap/css/bootstrap.css' t-ignore="true"/>
            <link rel="stylesheet" href='/website/static/src/css/website.css' t-ignore="true"/>
            <t t-set="view" t-value="html_view"/>
            <div t-raw="view"/>
        </template>        
        
    </data>
</openerp>